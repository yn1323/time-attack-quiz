# クイズ関連リンク機能 実装計画

## 概要

クイズ問題に関連リンク（URL）を追加し、OGP情報を取得してSNS風のリンクカードとして表示する機能を実装する。

## 背景

キャラクターものの問題で、各キャラクターの説明URLをリンクカードとして表示したい。
回答のヒントや追加情報として活用する。

---

## 仕様

### JSON構造

```json
{
  "question": "このキャラクターは誰？",
  "choices": ["キャラA", "キャラB", "キャラC"],
  "answer": 0,
  "relatedLinks": [
    "https://example.com/character-info",
    "https://example.com/official-site"
  ]
}
```

| フィールド | 型 | 説明 |
|-----------|-----|------|
| `relatedLinks` | string[] | 関連リンクのURL配列（省略可） |

### 表示仕様

| 項目 | 仕様 |
|------|------|
| 表示タイミング | 回答前から表示 |
| レイアウト | 3列グリッド |
| 数量 | 0-4個程度を想定 |
| 0個の場合 | リンクエリアごと非表示 |
| OGP取得 | 動的取得（APIルート経由） |
| 取得失敗時 | デフォルト画像＋URLでカード表示 |

### 表示位置

```
[問題文]
[選択肢A]
[選択肢B]
[選択肢C]
↓ ここに追加
[リンクカード1] [リンクカード2] [リンクカード3]
```

---

## 実装タスク

### 1. 型定義の更新

**ファイル:** `types/firestore.ts`

```typescript
export interface Question {
  question: string
  choices: string[]
  answer: number
  relatedLinks?: string[] // 追加
}
```

### 2. OGP情報取得APIの実装

**ファイル:** `app/api/ogp/route.ts` (新規作成)

- クエリパラメータでURLを受け取る
- OGP情報（title, description, image）を取得して返す
- 取得失敗時はエラーレスポンス

**レスポンス形式:**
```typescript
{
  url: string
  title: string
  description: string
  image: string
}
```

### 3. リンクカードコンポーネント作成

**ファイル:** `app/lobby/[lobbyId]/group/[groupId]/_components/RelatedLinkCard.tsx` (新規作成)

- URLを受け取ってOGP情報を取得・表示
- ローディング状態の表示
- 取得失敗時はデフォルト画像＋URL表示
- クリックで新しいタブで開く

### 4. リンクカード一覧コンポーネント作成

**ファイル:** `app/lobby/[lobbyId]/group/[groupId]/_components/RelatedLinks.tsx` (新規作成)

- `relatedLinks` 配列を受け取る
- 3列グリッドレイアウトで表示
- 空配列の場合は何も表示しない

### 5. GroupQuizコンポーネントへの組み込み

**ファイル:** `app/lobby/[lobbyId]/group/[groupId]/_components/GroupQuiz.tsx`

- 選択肢の下に `<RelatedLinks>` を配置
- クイズデータから `relatedLinks` を取得して渡す

### 6. デフォルト画像の準備

**ファイル:** `public/images/default-link-card.png` など

- OGP取得失敗時に表示する画像
- シンプルなリンクアイコンやロゴ

### 7. サンプルデータ追加＋動作確認

**ファイル:** `public/data/questions.json`

- 既存の問題に `relatedLinks` を追加
- 実際にOGP取得できるURLでテスト

---

## 技術選定

### OGP取得ライブラリ

以下のいずれかを使用：
- `open-graph-scraper`
- `oembed-parser`
- 独自実装（cheerioなど）

### グリッドレイアウト

Chakra UI v3のグリッドコンポーネントを使用

---

## 注意事項

- PC専用アプリなので、レスポンシブ対応は不要
- OGP取得はサーバーサイドで行う（CORS回避）
- 外部URLへのアクセスタイムアウトを設定（5秒程度）
- キャッシュ戦略は後で検討（初回は都度取得でOK）

---

## 今後の拡張案

- OGP情報のキャッシュ
- リンクカードのホバーアニメーション
- リンク先のサムネイルプレビュー
